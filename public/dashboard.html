<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>YT Playlist Bot ‚Äì Dashboard</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 20px; background: #0f172a; color: #e5e7eb; }
    h1 { margin-bottom: 16px; }
    .grid { display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
    .card { background: #020617; border-radius: 8px; padding: 16px; border: 1px solid #1f2937; }
    .title { font-weight: 600; margin-bottom: 8px; }
    .meta { font-size: 14px; color: #9ca3af; margin-bottom: 8px; }
    .reactions { font-size: 14px; margin-bottom: 8px; }
    .links a { color: #38bdf8; text-decoration: none; margin-right: 8px; font-size: 14px; }
    .links a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <h1>YT Playlist Bot ‚Äì Dashboard</h1>
  <p>√öltimo video notificado por playlist.</p>

  <div id="grid" class="grid"></div>

  <script>
    async function loadDashboard() {
      const res = await fetch('/api/dashboard/latest');
      const json = await res.json();
      const grid = document.getElementById('grid');
      grid.innerHTML = '';

      if (!json.ok) {
        grid.textContent = 'Error cargando datos del dashboard';
        return;
      }

      const data = json.data || {};
      for (const [playlistId, item] of Object.entries(data)) {
        const card = document.createElement('div');
        card.className = 'card';

        if (!item) {
          card.innerHTML = `
            <div class="title">Playlist ${playlistId}</div>
            <div class="meta">Sin videos registrados a√∫n.</div>
          `;
          grid.appendChild(card);
          continue;
        }

        const reactions = item.reactions || {};
        const rText =
          `üëç ${reactions.like || 0} ¬∑ ‚ù§Ô∏è ${reactions.love || 0} ¬∑ üò° ${reactions.angry || 0}`;

        card.innerHTML = `
          <div class="title">${item.title}</div>
          <div class="meta">
            Canal: ${item.channelTitle || 'Desconocido'}<br />
            Publicado: ${item.publishedAt || 'Desconocido'}<br />
            Playlist ID: ${playlistId}
          </div>
          <div class="reactions">${rText}</div>
          <div class="links">
            <a href="${item.url}" target="_blank" rel="noopener noreferrer">Ver video</a>
          </div>
        `;

        grid.appendChild(card);
      }
    }

    loadDashboard();
  </script>
</body>
</html>
